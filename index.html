<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AURA Live Radio WS</title>

<style>
/* ---------------- GLOBAL ---------------- */
* { box-sizing:border-box; }
body { margin:0; font-family:system-ui,sans-serif; background:#f5f5f5; }

/* ---------------- GRID ---------------- */
#container-grid {
  display:grid;
  grid-template-rows:auto 1fr auto;
  height:100vh;
  gap:0.25rem;
}

/* ---------------- PLAYER ---------------- */
#player {
  display:flex; flex-wrap:wrap; align-items:center; gap:1rem;
  padding:0.5rem; background:#222; color:#fff; border-bottom:2px solid #444;
}
#player audio { flex:1 1 300px; }
#player button { padding:0.25rem 0.5rem; cursor:pointer; background:#444; border:none; color:#fff; border-radius:3px; }
#player button:hover { background:#666; }
#now-playing-container { display:flex; gap:0.5rem; align-items:center; }
#now-playing-container img { width:50px; height:50px; object-fit:cover; border-radius:5px; }
#live-status { margin-left:auto; display:flex; gap:1rem; font-size:0.9em; align-items:center; }

/* ---------------- BROWSER ---------------- */
#browser { display:grid; grid-template-columns:repeat(4,1fr); overflow-x:auto; gap:0.5rem; padding:0.5rem; }
@media(max-width:50em){ #browser { grid-auto-flow:column; grid-auto-columns:100%; scroll-snap-type:x mandatory; } .panel { scroll-snap-align:start; } }

/* ---------------- PANELS ---------------- */
.panel {
  border:1px solid #ccc; border-radius:5px;
  display:flex; flex-direction:column; min-height:0; overflow:auto; padding:0.5rem; background:#fff;
}
.panel h2 { margin:0 0 0.5rem 0; font-size:1.1em; }

/* ---------------- QUEUE ---------------- */
#queue-list .item {
  display:flex; align-items:center; border-top:1px solid #ddd; border-bottom:1px solid #ddd; padding:0.25rem; gap:0.5rem;
}
#queue-list .item img { width:40px; height:40px; object-fit:cover; border-radius:4px; }
#queue-list .item span { flex:1 1 auto; }

/* ---------------- DETAIL ---------------- */
#detail img { max-width:100%; max-height:150px; object-fit:contain; margin:0.25rem auto; display:block; }
#related-artists, #related-albums, #related-tracks { display:flex; flex-wrap:wrap; gap:0.25rem; }
.related-item { width:80px; text-align:center; font-size:0.8em; cursor:pointer; }
.related-item img { width:100%; height:80px; object-fit:cover; border-radius:4px; }
.related-item:hover { transform:scale(1.05); transition:0.2s; }

/* ---------------- ACTIONS ---------------- */
#actions { display:flex; gap:0.5rem; flex-wrap:wrap; padding:0.5rem; border-top:2px solid #444; background:#eee; }
#actions button { padding:0.25rem 0.5rem; cursor:pointer; border:none; border-radius:3px; background:#555; color:#fff; }
#actions button:hover { background:#777; }
</style>
</head>

<body>
<div id="container-grid">

  <!-- PLAYER -->
  <div id="player">
    <audio controls autoplay id="player-audio"><audio controls autoplay src="http://icecast-server:8000/live"></audio></audio>
    <button id="next-track">Next Track</button>
    <button id="toggle-live">Go Live</button>
    <div id="now-playing-container">
      <img id="now-playing-cover" src="" alt="">
      <span id="now-playing">Now Playing: --</span>
    </div>
    <div id="live-status"><span id="listener-count">Listeners: 0</span></div>
  </div>

  <!-- BROWSER -->
  <div id="browser">

    <!-- REQUEST BUILDER -->
    <div id="request-builder" class="panel">
      <h2>Request Builder</h2>
      <label>Server URL
        <input type="text" id="server-url" value="http://127.0.0.1:8337/aura/">
      </label>
      <fieldset>
        <legend>Collection</legend>
        <label><input type="radio" name="collection" value="tracks" checked> tracks </label><href src="https://audiomack.com//embed/kubuleeofficial/playlist/latest"
        <label><input type="radio" name="collection" value="albums"> Albums</label>
        <label><input type="radio" name="collection" value="artists"> Artists</label>
      </fieldset>
      <label>Filters
        <textarea id="filters" rows="4"></textarea>
      </label>
      <label>Sort string
        <input type="text" id="sort-string">
      </label>
      <button type="button" onclick="buildAndMakeRequest()">Make Request</button>
    </div>

    <!-- RESULTS -->
    <div id="results" class="panel">
      <h2>Results</h2>
      <div id="results-list"></div>
    </div>

    <!-- DETAIL -->
    <div id="detail" class="panel">
      <h2>Detail</h2>
      <img id="item-image" alt="">
      <table id="item-attributes"></table>

      <h3>Related Artists</h3>
      <div id="related-artists"></div>

      <h3>Related Albums</h3>
      <div id="related-albums"></div>

      <h3>Related Tracks</h3>
      <div id="related-tracks"></div>
    </div>

    <!-- QUEUE -->
    <div id="queue" class="panel">
      <h2>Queue</h2>
      <div id="queue-list"></div>
    </div>

  </div>

  <!-- ACTIONS -->
  <div id="actions">
    <button onclick="clearSelection()">Clear</button>
    <button onclick="prependToQueue()">Prepend</button>
    <button onclick="appendToQueue()">Append</button>
    <button onclick="removeFromQueue()">Remove</button>
    <button onclick="playSelected()">Play</button>
  </div>

</div>

<script>
/* ---------------- LIVE RADIO WS LOGIC ---------------- */
const audio=document.getElementById("player-audio");
const nowPlaying=document.getElementById("now-playing");
const nowPlayingCover=document.getElementById("now-playing-cover");
const listenerCount=document.getElementById("listener-count");

let liveMode=false;
let queue=[];
let currentIndex=0;

// WebSocket connection
const ws=new WebSocket("ws://127.0.0.1:9000/live"); // Replace with your WS server

ws.onopen=()=>console.log("WS Connected");
ws.onclose=()=>console.log("WS Disconnected");

ws.onmessage=(msg)=>{
  const data=JSON.parse(msg.data);

  // Handle new track
  if(data.type==="track"){
    addToQueue(data.track);
    if(liveMode) playTrack(queue.length-1);
  }

  // Update listeners
  if(data.type==="listeners"){
    listenerCount.textContent=`Listeners: ${data.count}`;
  }

  // Optional: update related tracks dynamically
  if(data.type==="related"){
    showRelated(data.track);
  }
};

/* ---------------- PLAYER LOGIC ---------------- */
document.getElementById("toggle-live").onclick=()=>{
  liveMode=!liveMode;
  document.getElementById("toggle-live").textContent=liveMode?"Stop Live":"Go Live";
  if(liveMode && queue.length) playTrack(currentIndex);
};

document.getElementById("next-track").onclick=()=>playNext();

function playTrack(index){
  if(!queue[index]) return;
  const track=queue[index];
  audio.src=track.url;
  audio.play();
  nowPlaying.textContent=`Now Playing: ${track.title} - ${track.artist}`;
  nowPlayingCover.src=track.cover||"";
  highlightQueueItem();
  showRelated(track);
}

function playNext(){
  if(!queue.length) return;
  currentIndex=(currentIndex+1)%queue.length;
  playTrack(currentIndex);
}

function addToQueue(track){
  queue.push(track);
  updateQueueUI();
}

function updateQueueUI(){
  const qEl=document.getElementById("queue-list");
  qEl.innerHTML="";
  queue.forEach((t,i)=>{
    const div=document.createElement("div");
    div.className="item";
    const img=document.createElement("img");
    img.src=t.cover||"";
    const span=document.createElement("span");
    span.textContent=t.title;
    div.appendChild(img);
    div.appendChild(span);
    qEl.appendChild(div);
  });
  highlightQueueItem();
}

function highlightQueueItem(){
  const items=document.querySelectorAll("#queue-list .item");
  items.forEach((el,i)=>el.style.fontWeight=i===currentIndex?"bold":"normal");
}

function showRelated(track){
  const relatedTracks=document.getElementById("related-tracks");
  relatedTracks.innerHTML="";
  for(let i=1;i<=3;i++){
    const div=document.createElement("div");
    div.className="related-item";
    div.innerHTML=`<img src="${track.cover||''}" alt=""><br>${track.title} ${i}`;
    relatedTracks.appendChild(div);
  }
}

/* Dummy buttons */
function clearSelection(){}
function prependToQueue(){}
function appendToQueue(){}
function removeFromQueue(){}
function playSelected(){}
function buildAndMakeRequest(){}

// Example tracks for demo
addToQueue({title:"Song 1", artist:"DJ A", url:"song1.mp3", cover:"cover1.jpg"});
addToQueue({title:"Song 2", artist:"DJ B", url:"song2.mp3", cover:"cover2.jpg"});
addToQueue({title:"Song 3", artist:"DJ C", url:"song3.mp3", cover:"cover3.jpg"});

audio.onended=()=>{ if(liveMode) playNext(); };
<iframe src="https://audiomack.com//embed/kubuleeofficial/playlist/cole" scrolling="no" width="100%" height="400" frameborder="0" title="Cole"></iframe>
<iframe src="https://audiomack.com//embed/kubuleeofficial/playlist/latest" scrolling="no" width="100%" height="400" frameborder="0" title="big boy sound"></iframe>
</script>
</body>
</html>
